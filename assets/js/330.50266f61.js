(window.webpackJsonp=window.webpackJsonp||[]).push([[330],{598:function(t,n,a){"use strict";a.r(n);var s=a(9),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"轮子-mini-single-spa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轮子-mini-single-spa"}},[t._v("#")]),t._v(" [轮子]mini-single-spa")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/woai3c/mini-single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/woai3c/mini-single-spa"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/woai3c/Front-end-articles/issues/31",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/woai3c/Front-end-articles/issues/31"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("single-spa、qiankun、micro-app @diff\n\n===\nextractScriptsAndStyles(node: Element, app: Application) \n")])])]),a("h1",{attrs:{id:"注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册"}},[t._v("#")]),t._v(" 注册")]),t._v(" "),a("ul",[a("li",[t._v("URL监听")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("重写两个 API 和监听两个事件\n\n重写 window.history.pushState()\n重写 window.history.replaceState()\n监听 popstate 事件\n监听 hashchange 事件\n")])])]),a("ul",[a("li",[t._v("正常加载")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("拉取 HTML 内容\n\n解析 HTML 并提取 style script 标签内容\n\n添加 style 标签，执行 script 脚本内容\n\n将剩下的 body 部分的 HTML 内容赋值给子应用要挂载的 DOM 下\n")])])]),a("ul",[a("li",[t._v("卸载子应用")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pageEntry\n\n===\nwindow['mini-single-spa-vue'] = {\n    bootstrap,\n    mount,\n    unmount\n}\n\n===\nregisterApplication({\n    name: 'vue',\n    pageEntry: 'http://localhost:8001',\n    activeRule: pathPrefix('/vue'),\n    container: $('#subapp-viewport')\n})\n\nregisterApplication({\n    name: 'react',\n    pageEntry: 'http://localhost:8002',\n    activeRule:pathPrefix('/react'),\n    container: $('#subapp-viewport')\n})\n\nstart()\n")])])]),a("h1",{attrs:{id:"隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隔离"}},[t._v("#")]),t._v(" 隔离")]),t._v(" "),a("ul",[a("li",[t._v("Proxy代理")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('app.window = new Proxy({}, {\n    get(target, key) {\n        if (Reflect.has(target, key)) {\n            return Reflect.get(target, key)\n        }\n        \n        const result = originalWindow[key]\n        // window 原生方法的 this 指向必须绑在 window 上运行，否则会报错 "TypeError: Illegal invocation"\n        // e.g: const obj = {}; obj.alert = alert;  obj.alert();\n        return (isFunction(result) && needToBindOriginalWindow(result)) ? result.bind(window) : result\n    },\n\n    set: (target, key, value) => {\n    \tthis.injectKeySet.add(key)\n        return Reflect.set(target, key, value)\n    }\n})\n')])])]),a("ul",[a("li",[t._v("卸载时清除子应用 window 作用域")]),t._v(" "),a("li",[t._v("记录绑定的全局事件、定时器，卸载时清除")]),t._v(" "),a("li",[t._v("缓存子应用快照")]),t._v(" "),a("li",[t._v("隔离子应用元素作用域")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// 作用域隔离\n重写查询类的 DOM API\n\n\n===\n// 样式隔离 single-spa-name 属性\ndiv[single-spa-name=vue] {\n\tcolor: red;\n}\n\n===\n// 样式隔离 @old\nconst re = /^(\\s|,)?(body|html)\\b/g\n// 将 body html 标签替换为子应用挂载容器的 id\ncssText.replace(re, `#${app.container.id}`)\n")])])]),a("p",[a("img",{attrs:{src:"https://luo0412.oss-cn-hangzhou.aliyuncs.com/1653982122187-atXknyQitKmK.png",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通信"}},[t._v("#")]),t._v(" 通信")]),t._v(" "),a("ul",[a("li",[t._v("window.spaGlobalState")]),t._v(" "),a("li",[t._v("订阅/发布")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父应用")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spaGlobalState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'父应用在 spa 全局状态上新增了一个 msg 属性'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子应用")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spaGlobalState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" operator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue 子应用监听到 spa 全局状态发生了变化: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("，操作: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("operator"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("，变化的属性: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父应用")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spaGlobalState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testEvent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'父应用发送了一个全局事件: testEvent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子应用")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spaGlobalState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testEvent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue 子应用监听到父应用发送了一个全局事件: testEvent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("hr"),t._v(" "),a("h1",{attrs:{id:"参考-ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考-ref"}},[t._v("#")]),t._v(" 参考 @ref")])])}),[],!1,null,null,null);n.default=e.exports}}]);